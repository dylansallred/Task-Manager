<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
    --primary: #7c3aed;
    --primary-hover: #6d28d9;
    --primary-hove-opacityr: #4c2c9461;
    --background: #1a1a1a;
    --background-secondary: #242424;
    --surface: #2d2d2d;
    --surface-hover: #3d3d3d;
    --text: #ffffff;
    --text-secondary: #a0a0a0;
    --danger: #dc2626;
    --danger-hover: #b91c1c;
    --success: #10b981;
    --low-priority: #3b82f6;
    --medium-priority: #f59e0b;
    --high-priority: #ef4444;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', system-ui, sans-serif;
    background-color: var(--background);
    color: var(--text);
    min-height: 100vh;
    padding: 2rem;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background: var(--background-secondary);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.header {
    margin-bottom: .5rem;
    text-align: center;
}

.header h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.stats {
    margin: auto;
    display: flex;
    color: var(--text-secondary);
    font-size: 0.9rem;
    align-items: center;
}

.stats span {
    border-radius: 0.5rem;
    padding: 0.2rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.stats .completed {
    color: var(--success);
}

.stats .total {
    color: var(--text);
}

.input-area {
    display: grid;
    grid-template-columns: 1fr auto auto auto;
    gap: 0.5rem;
}

#task-input,
#priority-select,
#due-date {
    padding: 0.5rem;
    background: var(--background);
    border: 1px solid #3d3d3d;
    border-radius: 0.5rem;
    color: var(--text);
    font-size: .85rem;
    transition: all 0.2s ease;
    color-scheme: dark;
}

#task-input:focus,
#priority-select:focus,
#due-date:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

.glow-button {
    padding: 0.8rem 1.5rem;
    background: linear-gradient(135deg, var(--primary), #6d28d9);
    border: none;
    border-radius: 0.5rem;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.glow-button:hover {
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
}

.filters,
.search-container,
.sort-wrapper {
    display: flex;
    gap: 0.5rem;
    margin: .5rem;
    align-items: center;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 0.5rem 1rem;
    background: var(--background);
    border: none;
    border-radius: 0.5rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-btn.active {
    background: var(--primary);
    color: white;
}

#task-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    padding: 0.5rem;
}

.task-item {
    display: flex;
    align-items: stretch;
    padding: 1.2rem;
    background: var(--background);
    border-radius: 0.8rem;
    transition: all 0.2s ease;
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: relative;
    cursor: pointer;
    border-bottom: 2px solid transparent;
}

.task-item:hover {
    box-shadow: 0 4px 8px 0px rgba(0, 0, 0, 0.2), inset 0px 0px 10px 3px rgb(17 17 17);
    scale: 1.01;
}

.task-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    border-radius: 0.8rem 0 0 0.8rem;
    background: var(--surface);
    transition: background-color 0.2s ease;
}

.task-item.low::before { background: var(--low-priority); }
.task-item.medium::before { background: var(--medium-priority); }
.task-item.high::before { background: var(--high-priority); }
.task-item.completed::before { background: var(--success); opacity: 0.7; }
.task-item.completed { opacity: 0.8; background: rgba(255, 255, 255, 0.03); box-shadow: none; }
.task-item.completed:hover { opacity: 1; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }

.task-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-right: 1rem;
}

.task-main, .subtasks-list {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
}

.task-text, .subtask-text {
    font-size: .9rem;
    border-radius: 0.3rem;
    transition: background-color 0.2s;
    background: transparent;
    cursor: pointer;
    position: relative;
}
.task-text{
    font-size: 1.2rem;
    margin-bottom: .5rem;
    width: fit-content;
    padding: 0.2rem;

}

.task-text:focus, .subtask-text:focus {
    background: rgba(255, 255, 255, 0.05);
    outline: none;
    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.3);
}

.task-details {
    display: flex;
    gap: 1rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    align-items: center;
}
.task-details input, .task-details select{
   outline: none;
   box-shadow: 0px 0px 0px 1px var(--primary), 0px 0px 5px 1px var(--primary);
   border-radius: .3rem;
   background-color: var(--surface-hover);
   color: var(--text);
   border: none;
   padding: .1rem;
   font-size: .8rem;
}

.priority, .due-date {
    padding: 0.3rem 0.8rem;
    border-radius: 1rem;
    font-weight: 600;
    text-transform: capitalize;
    font-size: 0.7rem;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.priority.low { background: rgba(59, 130, 246, 0.2); color: var(--low-priority); }
.priority.medium { background: rgba(245, 158, 11, 0.2); color: var(--medium-priority); }
.priority.high { background: rgba(239, 68, 68, 0.2); color: var(--high-priority); }

.due-date {
    background: rgba(255, 255, 255, 0.03);
    transition: all 0.2s ease;
    color-scheme: dark;
}

.due-date-input{
    color-scheme: dark;
}

.due-date:hover {
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
}

.task-actions {
    display: flex;
    gap: 0.5rem;
    margin-left: auto;
    flex-direction: column;
    justify-content: center;
}

.task-actions button, .subtask-actions button {
    padding: 0.3rem;
    border: none;
    border-radius: 0.5rem;
    background: rgba(255, 255, 255, 0.03);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    width: 1.5rem;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.task-actions button:hover, .subtask-actions button:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text);
}
.delete-btn{
    width: 3rem!important;
}

.task-actions .delete-btn:hover { background: rgba(220, 38, 38, 0.1); color: var(--danger); }
.task-actions .edit-btn:hover { background: rgba(124, 58, 237, 0.1); color: var(--primary); }
.completed .task-text { text-decoration: line-through; opacity: 0.7; }

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
}

.modal-content {
    position: relative;
    background-color: var(--surface);
    margin: 50px auto;
    padding: 2rem;
    border-radius: 1rem;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.close-modal {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
}

.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
}

.form-group input,
.form-group textarea,
.form-group select,
.subtask-input {
    width: 100%;
    padding: 0.3rem;
    background: var(--background);
    border: 2px solid #3d3d3d;
    border-radius: 0.5rem;
    color: var(--text);
    font-size: 1rem;
    transition: all 0.2s ease;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus,
.subtask-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.subtasks-section {
    transition: all 0.3s ease;
    margin-top: 0.5rem;
}

.task-item {
    cursor: pointer;
}



.task-content {
    pointer-events: none;
}

.task-content * {
    pointer-events: auto;
    cursor: pointer!important;
}



.subtask-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0rem 0.5rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 0.3rem;
    width: 100%;
    justify-content: space-between;
}

.subtask-item:hover {
    scale: 1.01;
    background: #4c2c9442;
    box-shadow: 0px 0px 0px 1px #7c3aed9c;
}

.subtask-checkbox {
    cursor: pointer;
}

.subtask-item.completed .subtask-text {
    text-decoration: line-through;
    opacity: 0.7;
}

.add-subtask-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.3rem;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    margin-top: 0.3rem;
    margin-top: 0.5rem;
    display: none; 
}

.add-subtask-btn:hover {
    color: var(--primary);
}

.subtask-input-container {
    display: none;
    gap: 0.5rem;
    align-items: center;
    margin-top: 1rem;
}

.subtask-input-actions {
    display: flex;
    gap: 0.3rem;
}

.subtask-input-actions button { 
    padding: 0.3rem;
    border-radius: 0.3rem;
    width: 1.5rem;
    outline: none;
    border: none;
    color: var(--text);
    background-color: var(--surface-hover);

}

.save-subtask-btn:hover { color: var(--success); background: rgba(16, 185, 129, 0.1); }
.cancel-subtask-btn:hover, .delete-subtask-btn:hover { color: var(--danger); background: rgba(220, 38, 38, 0.1); }

.delete-subtask-btn {
    opacity: 0;
    transition: opacity 0.2s;
}

.delete-subtask-btn:hover {
    color: var(--danger)!important;
}
.edit-subtask-btn:hover {
    color: var(--success)!important;
}

.subtask-item:hover .delete-subtask-btn {
    opacity: 1;
}

.modal-footer {
    margin-top: 1.5rem;
    display: flex;
    justify-content: flex-end;
}

.modal.show {
    display: block;
}

#sort-select {
    padding: 0.5rem;
    background: var(--background);
    border: 1px solid #3d3d3d;
    border-radius: 0.5rem;
    color: var(--text);
    cursor: pointer;
    min-width: 150px;
}

#sort-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

.sort-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.subtask-text-edit {
    border-color: var(--primary);
    box-shadow: 0 0 5px 4px rgba(124, 58, 237, 0.2);
    background: var(--surface-hover);
    outline: none;
    color: var(--text);
    border-radius: 0.3rem;
    padding: 0.1rem;
    
}

.subtask-actions {
    display: flex;
    gap: 0.3rem;
    margin-left: 10px;
    flex-shrink: 0;
    align-items: center;
}

.edit-subtask-btn {
    opacity: 0;
    transition: opacity 0.2s;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.2rem;
}

.subtask-item:hover .edit-subtask-btn {
    opacity: 1;
}

.edit-subtask-btn:hover {
    color: var(--success);
}

.subtask-item.editing {
    background: none !important;
    box-shadow: none !important;
    scale: 1 !important;
}

.subtask-item.editing .delete-subtask-btn,
.subtask-item.editing .edit-subtask-btn {
    opacity: 0 !important;
    pointer-events: none;
}

#search-input {
    flex-grow: 1;
    padding: 0.8rem 1rem;
    background: var(--background);
    border: 1px solid #3d3d3d;
    border-radius: 0.5rem;
    color: var(--text);
    font-size: 1rem;
    transition: all 0.2s ease;
}

#search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

#clear-search {
    padding: 0.8rem;
    aspect-ratio: 1/1;
    display: none;
}

#clear-search.visible {
    display: block;
}

.search-match {
    background: var(--primary);
    border-radius: 0.2rem;
    font-weight: 500;
}

.task-checkbox {
    position: relative;
    width: 1.4rem;
    height: 1.4rem;
    margin-right: 1.2rem;
    cursor: pointer;
    appearance: none;
    border: 2px solid var(--text-secondary);
    border-radius: 0.4rem;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.task-checkbox::after {
    content: '';
    position: absolute;
    width: 0.7rem;
    height: 0.4rem;
    border: 2px solid var(--surface);
    border-top: none;
    border-right: none;
    transform: rotate(-45deg);
    opacity: 0;
    transition: all 0.2s ease;
}

.task-checkbox:hover {
    border-color: var(--primary);
    transform: scale(1.1);
}

.task-checkbox:checked {
    background: var(--primary);
    border-color: var(--primary);
}

.task-checkbox:checked::after {
    opacity: 1;
}

.task-checkbox:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

.task-item.completed .task-checkbox {
    background: var(--success);
    border-color: var(--success);
}

.task-item.completed .task-checkbox::after {
    border-color: var(--surface);
}

.task-text-edit {
    background: var(--surface-hover);
    outline: none;
    border: 2px solid var(--primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
    color: var(--text);
    border-radius: 0.3rem;
    padding: 0.2rem;
    font-size: 1rem;
    width: fit-content;
    transition: all 0.2s ease;
}

.task-text-edit:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.3);
    margin-bottom: 0.5rem;
}

@media (max-width: 768px) {
    .container { padding: 1rem; }
    .input-area { grid-template-columns: 1fr; }
}

.sticky-top {
    position: sticky;
    top: -2px;
    background: var(--background-secondary);
    z-index: 10;
    padding-top: 1rem;
    padding-bottom: .5rem;
    border-radius: 1rem;
    margin-top: -2px;
}

.task-item:hover .fa-chevron-up,
.task-item:hover .fa-chevron-down {
    color: var(--primary);
    transform: scale(1.1);
    transition: all 0.2s ease;
}

.fa-chevron-up,
.fa-chevron-down {
    transition: all 0.2s ease;
}

.task-text:hover {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 0.3rem;
    cursor: text;
}

.priority:hover {
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
}

.due-date:hover {
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
}

.task-text,
.priority,
.due-date {
    transition: all 0.2s ease;
}

.task-text:hover,
.priority:hover,
.due-date:hover {
    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.1);
}

.task-text[contenteditable="true"],
.priority[contenteditable="true"],
.due-date[contenteditable="true"] {
    background: rgba(255, 255, 255, 0.05);
    box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.2);
}

.task-item.collapsed.low {
    border-bottom-color: var(--low-priority);
    border-image: linear-gradient(
        90deg,
        transparent,
        var(--low-priority),
        transparent
    ) 1;
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.15);
}

.task-item.collapsed.medium {
    border-bottom-color: var(--medium-priority);
    border-image: linear-gradient(
        90deg,
        transparent,
        var(--medium-priority),
        transparent
    ) 1;
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.15);
}

.task-item.collapsed.high {
    border-bottom-color: var(--high-priority);
    border-image: linear-gradient(
        90deg,
        transparent,
        var(--high-priority),
        transparent
    ) 1;
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.15);
}

.task-item.collapsed.completed {
    border-bottom-color: var(--success);
    border-image: linear-gradient(
        90deg,
        transparent,
        var(--success),
        transparent
    ) 1;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.15);
}

.task-item.collapsed.low::after {
    background: linear-gradient(90deg, 
        transparent, 
        rgba(59, 130, 246, 0.7), 
        transparent
    );
}

.task-item.collapsed.medium::after {
    background: linear-gradient(90deg, 
        transparent, 
        rgba(245, 158, 11, 0.7), 
        transparent
    );
}

.task-item.collapsed.high::after {
    background: linear-gradient(90deg, 
        transparent, 
        rgba(239, 68, 68, 0.7), 
        transparent
    );
}

.task-item.collapsed.completed::after {
    background: linear-gradient(90deg, 
        transparent, 
        rgba(16, 185, 129, 0.7), 
        transparent
    );
}

.subtask-text {
    flex-grow: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.subtask-actions button {
    width: 1.5rem;
    height: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}
#total-tasks {
    color: var(--high-priority);
}
#completed-tasks {
    color: var(--success);
}

@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}

.input-error {
    animation: shake 0.3s ease-in-out;
    border-color: var(--danger) !important;
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2) !important;
}

#priority-select, #modal-priority-select, #sort-select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.5rem center;
    background-size: 1rem;
    padding-right: 2rem;
    cursor: pointer;
}

#priority-select:hover, #modal-priority-select:hover, #sort-select:hover,
#priority-select:focus, #modal-priority-select:focus, #sort-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

#priority-select option, #modal-priority-select option, #sort-select option {
    background-color: var(--background);
    color: var(--text);
    padding: 0.5rem;
}

select::-ms-expand {
    display: none; 
}

.added-date {
    background: rgba(255, 255, 255, 0.03);
    padding: 0.3rem 0.8rem;
    border-radius: 1rem;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    transition: all 0.2s ease;
}

.added-date:hover {
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-tasks"></i> Task Manager</h1>
        </div>


        <div class="sticky-top">
            <div class="input-area">
                <input type="text" id="task-input" placeholder="What needs to be done?">
                <select id="priority-select">
                    <option value="low">Low Priority</option>
                    <option value="medium">Medium Priority</option>
                    <option value="high">High Priority</option>
                </select>
                <input type="date" id="due-date">
                <button id="add-button" class="glow-button">
                    <i class="fas fa-plus"></i> Add Task
                </button>
                <!-- Add Test Data Button -->
                <button id="add-test-data" class="glow-button" style="background: linear-gradient(135deg, #8b5cf6, #4f46e5);">
                    <i class="fas fa-vial"></i> Add Test Tasks
                </button>
            </div>

            <div class="filters">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="active">Active</button>
                <button class="filter-btn" data-filter="completed">Completed</button>
                <div class="stats">
                    <span class="completed" id="completed-tasks">0</span>
                    <span>/</span>
                    <span class="total" id="total-tasks">0</span>
                    <span>tasks completed</span>
                </div>
            </div>

            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search tasks...">
                <button id="clear-search" class="glow-button" title="Clear search">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <div id="task-list"></div>

        <div id="task-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Task Details</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="modal-task-title">Title</label>
                        <input type="text" id="modal-task-title">
                    </div>
                    <div class="form-group">
                        <label for="modal-task-description">Description</label>
                        <textarea id="modal-task-description" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="modal-priority-select">Priority</label>
                            <select id="modal-priority-select">
                                <option value="low">Low Priority</option>
                                <option value="medium">Medium Priority</option>
                                <option value="high">High Priority</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modal-due-date">Due Date</label>
                            <input type="date" id="modal-due-date">
                        </div>
                    </div>
                    <div class="subtasks-section">
                        <h3>Subtasks</h3>
                        <div class="subtask-input-group">
                            <input type="text" id="subtask-input" placeholder="Add a subtask and press Enter">
                            <button id="add-subtask-btn" class="glow-button">Add</button>
                        </div>
                        <ul id="subtasks-list"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    const generateUniqueKey = () => {
        const randomId = Math.random().toString(36).substring(2, 15);
        return `tasks_${randomId}`;
    };

    let storageKey = localStorage.getItem('taskManagerKey');
    if (!storageKey) {
        storageKey = generateUniqueKey();
        localStorage.setItem('taskManagerKey', storageKey);
    }

    document.addEventListener('DOMContentLoaded', function() {
        const taskInput = document.getElementById('task-input');
        const addButton = document.getElementById('add-button');
        const taskList = document.getElementById('task-list');
        const prioritySelect = document.getElementById('priority-select');
        const dueDateInput = document.getElementById('due-date');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const totalTasksSpan = document.getElementById('total-tasks');
        const completedTasksSpan = document.getElementById('completed-tasks');
        const searchInput = document.getElementById('search-input');
        const clearSearchButton = document.getElementById('clear-search');
    
        const sortWrapper = document.createElement('div');
        sortWrapper.className = 'sort-wrapper';
        
        const sortLabel = document.createElement('span');
        sortLabel.textContent = 'Sort by: ';
        sortLabel.className = 'sort-label';
        
        const sortSelect = document.createElement('select');
        sortSelect.id = 'sort-select';
        sortSelect.innerHTML = `
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="priority">Priority</option>
            <option value="dueDate">Due Date</option>
            <option value="alphabetical">Alphabetical</option>
        `;
    

        const filtersDiv = document.querySelector('.filters');
        const statsDiv = filtersDiv.querySelector('.stats');  
        sortWrapper.appendChild(sortLabel);
        sortWrapper.appendChild(sortSelect);
        filtersDiv.insertBefore(sortWrapper, statsDiv);  
    
        let tasks = loadTasks();
        let currentFilter = 'all';
        let currentSort = 'newest';
        let openSubtaskTaskId = null;
        let isAddingSubtask = false;
        let searchQuery = '';
    
        renderTasks();
        updateStats();
    

        addButton.addEventListener('click', addTask);
        taskInput.addEventListener('keypress', (e) => e.key === 'Enter' && addTask());
        filterButtons.forEach(btn => btn.addEventListener('click', applyFilter));
        sortSelect.addEventListener('change', (e) => {
            currentSort = e.target.value;
            renderTasks();
        });
        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            if (searchQuery) {
                clearSearchButton.classList.add('visible');
            } else {
                clearSearchButton.classList.remove('visible');
            }
            renderTasks();
        });
        clearSearchButton.addEventListener('click', () => {
            searchInput.value = '';
            searchQuery = '';
            clearSearchButton.classList.remove('visible');
            renderTasks();
        });
    
        function addTask() {
            const taskText = taskInput.value.trim();
            if (!taskText) {
                taskInput.classList.add('input-error');
                setTimeout(() => {
                    taskInput.classList.remove('input-error');
                }, 300);
                return;
            }
    
            const newTask = {
                id: Date.now(),
                text: taskText,
                completed: false,
                priority: prioritySelect.value,
                dueDate: dueDateInput.value,
                createdAt: new Date().toISOString(),
                subtasks: [],
                collapsed: false
            };
    
            tasks.unshift(newTask);
            saveTasks();
            renderTasks();
            updateStats();
            clearInputs();
        }
    
        function renderTasks() {
            taskList.innerHTML = '';
            let filteredTasks = tasks.filter(task => {

                if (currentFilter === 'active' && task.completed) return false;
                if (currentFilter === 'completed' && !task.completed) return false;
                

                if (searchQuery) {
                    const matchesText = task.text.toLowerCase().includes(searchQuery);
                    const matchesSubtasks = task.subtasks?.some(subtask => 
                        subtask.text.toLowerCase().includes(searchQuery)
                    );
                    return matchesText || matchesSubtasks;
                }
                return true;
            });
    
   
            filteredTasks.sort((a, b) => {
                switch (currentSort) {
                    case 'newest':
                        return b.createdAt.localeCompare(a.createdAt);
                    case 'oldest':
                        return a.createdAt.localeCompare(b.createdAt);
                    case 'priority':
                        const priorityOrder = { high: 0, medium: 1, low: 2 };
                        return priorityOrder[a.priority] - priorityOrder[b.priority];
                    case 'dueDate':
                        if (!a.dueDate) return 1;
                        if (!b.dueDate) return -1;
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    case 'alphabetical':
                        return a.text.localeCompare(b.text);
                    default:
                        return 0;
                }
            });
    
            filteredTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                taskList.appendChild(taskElement);
            });
        }
    
        function createTaskElement(task) {
            const taskItem = document.createElement('li');
            taskItem.className = `task-item ${task.completed ? 'completed' : ''} ${task.priority}`;
            taskItem.dataset.taskId = task.id;
    
            taskItem.innerHTML = `
                <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                <div class="task-content">
                    <div class="task-main">
                        <span class="task-text">${task.text}</span>
                        <div class="task-details">
                            <span class="priority ${task.priority}">${task.priority}</span>
                            <span class="due-date">
                                ${task.dueDate ? `<i class="far fa-calendar-alt"></i> ${formatDate(task.dueDate)}` : '<i class="far fa-calendar-alt"></i> Due Date'}
                            </span>
                            <span class="added-date" title="Added on ${formatDateTime(task.createdAt)}">
                                <i class="fas fa-plus"></i> ${formatDateTimeShort(task.createdAt)}
                            </span>
                        </div>
                    </div>
                    <div class="subtasks-section">
                        <div class="subtasks-list">
                            ${(task.subtasks || []).map(subtask => `
                                <div class="subtask-item ${subtask.completed ? 'completed' : ''}" data-subtask-id="${subtask.id}">
                                    <input type="checkbox" class="subtask-checkbox" ${subtask.completed ? 'checked' : ''}>
                                    <span class="subtask-text">${subtask.text}</span>
                                    <div class="subtask-actions">
                                        <button class="edit-subtask-btn" title="Edit"><i class="fas fa-edit"></i></button>
                                        <button class="delete-subtask-btn" title="Delete"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <button class="add-subtask-btn" title="Add Subtask"><i class="fas fa-plus"></i> Add Subtask</button>
                        <div class="subtask-input-container" style="display: none;">
                            <input type="text" class="subtask-input" placeholder="Enter subtask">
                            <div class="subtask-input-actions">
                                <button class="save-subtask-btn"><i class="fas fa-check"></i></button>
                                <button class="cancel-subtask-btn"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="task-actions">
                    <button class="delete-btn" title="Delete"><i class="fas fa-trash-alt"></i></button>
                </div>
            `;
    
            const checkbox = taskItem.querySelector('.task-checkbox');
            const taskTextSpan = taskItem.querySelector('.task-text');
            const prioritySpan = taskItem.querySelector('.priority');
            const dueDateSpan = taskItem.querySelector('.due-date');
            const deleteBtn = taskItem.querySelector('.delete-btn');
            const addSubtaskBtn = taskItem.querySelector('.add-subtask-btn');
            const subtaskInputContainer = taskItem.querySelector('.subtask-input-container');
            const subtaskInput = taskItem.querySelector('.subtask-input');
            const saveSubtaskBtn = taskItem.querySelector('.save-subtask-btn');
            const cancelSubtaskBtn = taskItem.querySelector('.cancel-subtask-btn');
    

            if (searchQuery) {
                const regex = new RegExp(`(${searchQuery})`, 'gi');
                taskTextSpan.innerHTML = task.text.replace(regex, '<span class="search-match">$1</span>');
                
    
                const subtaskItems = taskItem.querySelectorAll('.subtask-text');
                subtaskItems.forEach(subtaskText => {
                    const subtask = task.subtasks.find(st => st.text === subtaskText.textContent);
                    if (subtask && subtask.text.toLowerCase().includes(searchQuery)) {
                        subtaskText.innerHTML = subtask.text.replace(regex, '<span class="search-match">$1</span>');
                    }
                });
            } else {
                taskTextSpan.textContent = task.text;
            }
    
            prioritySpan.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                const select = createPrioritySelect(task.priority, (newValue) => {
                    task.priority = newValue;
                    saveTasks();
                    renderTasks();
                });
                prioritySpan.replaceWith(select);
                select.focus();
    
                select.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
    
                select.addEventListener('blur', () => {
                    saveTasks();
                    renderTasks();
                });
            });
    
            
            if (!task.dueDate) {
                dueDateSpan.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const input = createDateInput('', (newValue) => {
                        task.dueDate = newValue;
                        saveTasks();
                        renderTasks();
                    });
                    dueDateSpan.replaceWith(input);
                    input.focus();
                    setTimeout(() => input.showPicker(), 10);
    

                    input.addEventListener('click', (e) => {
                        e.stopPropagation();
                    });
    
                    input.addEventListener('blur', () => {
                        saveTasks();
                        renderTasks();
                    });
                });
            } else {
     
                dueDateSpan.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    const input = createDateInput(task.dueDate, (newValue) => {
                        task.dueDate = newValue;
                        saveTasks();
                        renderTasks();
                    });
                    dueDateSpan.replaceWith(input);
                    input.focus();
    
             
                    input.addEventListener('click', (e) => {
                        e.stopPropagation();
                    });
    
                    input.addEventListener('blur', () => {
                        saveTasks();
                        renderTasks();
                    });
                });
            }
    
        
            checkbox.addEventListener('change', () => toggleComplete(task.id));
            deleteBtn.addEventListener('click', () => deleteTask(task.id));
    

            addSubtaskBtn.addEventListener('click', () => {
                openSubtaskTaskId = task.id;
                addSubtaskBtn.style.display = 'none';
                subtaskInputContainer.style.display = 'flex';
                subtaskInput.focus();
            });
    
            function saveSubtask(keepOpen = false) {
                const subtaskText = subtaskInput.value.trim();

    
                if (subtaskText) {
                    if (!task.subtasks) task.subtasks = [];
                    const newSubtaskId = Date.now();
                    const newSubtask = {  
                        id: newSubtaskId,
                        text: subtaskText,
                        completed: false
                    };
                    task.subtasks.push(newSubtask); 
    
                    subtaskInput.value = '';
    
                    if (keepOpen) {
                       
                        const subtasksList = taskItem.querySelector('.subtasks-list');
                        const newSubtaskElement = document.createElement('div');
                        newSubtaskElement.className = `subtask-item`;
                        newSubtaskElement.dataset.subtaskId = newSubtaskId;
                        newSubtaskElement.innerHTML = `
                            <input type="checkbox" class="subtask-checkbox">
                            <span class="subtask-text">${subtaskText}</span>
                            <div class="subtask-actions">
                                <button class="edit-subtask-btn" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="delete-subtask-btn" title="Delete"><i class="fas fa-times"></i></button>
                            </div>
                        `;
                        subtasksList.appendChild(newSubtaskElement);
    
                        if (task.subtasks.length === 1 && !taskItem.querySelector('.task-details i.fas')) {
                            const taskDetails = taskItem.querySelector('.task-details');
                            const collapseIcon = document.createElement('i');
                            collapseIcon.className = 'fas fa-chevron-up';
                            collapseIcon.style.padding = '0 0.5rem';
                            collapseIcon.style.cursor = 'pointer';
                            taskDetails.prepend(collapseIcon);

                
                            taskItem.addEventListener('click', (e) => {
                                if (
                                    e.target.tagName === 'INPUT' || 
                                    e.target.tagName === 'BUTTON' || 
                                    e.target.closest('.task-actions') ||
                                    e.target.classList.contains('task-text') ||
                                    e.target.classList.contains('priority') ||
                                    e.target.classList.contains('due-date') ||
                                    subtaskInputContainer.style.display === 'flex'
                                ) {
                                    return;
                                }
                                const isCollapsed = subtasksSection.style.display === 'none';
                                subtasksSection.style.display = isCollapsed ? 'block' : 'none';
                                taskItem.classList.toggle('collapsed', !isCollapsed);
                                collapseIcon.className = `fas ${isCollapsed ? 'fa-chevron-up' : 'fa-chevron-down'}`;
                                
                     
                                task.collapsed = !isCollapsed;
                                saveTasks();
                                
                                addSubtaskBtn.style.display = isCollapsed ? 'block' : 'none';
                            });
                        }
    
     
                        const subtaskTextElem = newSubtaskElement.querySelector('.subtask-text');
                        const subtaskCheckbox = newSubtaskElement.querySelector('.subtask-checkbox');
                        const deleteBtn = newSubtaskElement.querySelector('.delete-subtask-btn');
                        const editBtn = newSubtaskElement.querySelector('.edit-subtask-btn');
    
                   
                        newSubtaskElement.addEventListener('click', (event) => {
                           
                            event.stopPropagation();
    
  
                            if (!event.target.closest('.subtask-actions')) {
                                toggleSubtaskComplete(task.id, newSubtaskId);
                            }
                        });
    
        
                        deleteBtn.addEventListener('click', () => {
                            deleteSubtask(task.id, newSubtaskId);
                        });
    
           
                        editBtn.addEventListener('click', (e) => {
                            const subtaskItem = e.target.closest('.subtask-item');
                            subtaskItem.classList.add('editing');
                            
                            const subtaskId = parseInt(subtaskItem.dataset.subtaskId);
                            const subtaskTextElem = subtaskItem.querySelector('.subtask-text');
                            const currentText = subtaskTextElem.textContent;
                            
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = currentText;
                            input.className = 'subtask-text-edit';
                            
                            input.addEventListener('blur', () => {
                                subtaskItem.classList.remove('editing');
                                const newText = input.value.trim();
                                if (newText) {
                                    const subtask = task.subtasks.find(st => st.id === subtaskId);
                                    if (subtask) {
                                        subtask.text = newText;
                                        saveTasks();
                                        renderTasks();
                                    }
                                }
                            });
                            
                            input.addEventListener('keypress', (e) => {
                                if (e.key === 'Enter') {
                                    input.blur();
                                }
                            });
                            
                            subtaskTextElem.replaceWith(input);
                            input.focus();
                        });
    
                        updateParentTaskCompletion(task.id, true); 

                        setTimeout(() => {
                            subtaskInput.focus();

                        }, 0);
    
                    } else {
                        console.log("keepOpen is false");
                        openSubtaskTaskId = null;
                        hideSubtaskInput();
                        updateParentTaskCompletion(task.id, false);
                        saveTasks(); 
                        renderTasks(); 
                
                    }
                } else if (!keepOpen) {

                    hideSubtaskInput();
                }
            }
    
            function hideSubtaskInput() {
                subtaskInput.value = '';
                subtaskInputContainer.style.display = 'none';
                addSubtaskBtn.style.display = 'block';
                if (openSubtaskTaskId === task.id) {
                    openSubtaskTaskId = null;
                }
            }
    
            subtaskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveSubtask(true);
                }
                if (e.key === 'Escape') {
                    hideSubtaskInput();
                }
            });
    
            saveSubtaskBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                saveSubtask();
            });
    
            cancelSubtaskBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                isAddingSubtask = false;
                hideSubtaskInput();
            });
    
            document.addEventListener('click', (e) => {
                if (!subtaskInputContainer.contains(e.target) &&
                    !addSubtaskBtn.contains(e.target) &&
                    subtaskInputContainer.style.display !== 'none') {
                    const subtaskText = subtaskInput.value.trim();
                    if (subtaskText) {
                        saveSubtask(false);
                    } else {
                        hideSubtaskInput();
                    }
                }
            });
    
            if (openSubtaskTaskId === task.id) {
                subtaskInputContainer.style.display = 'flex';
                addSubtaskBtn.style.display = 'none';
            }
    
            const subtaskItems = taskItem.querySelectorAll('.subtask-item');
            subtaskItems.forEach(item => {
                item.addEventListener('click', (event) => {
        
                    event.stopPropagation();
    
                    const subtaskId = parseInt(item.dataset.subtaskId);
    

                    if (!event.target.closest('.subtask-actions')) {
                        toggleSubtaskComplete(task.id, subtaskId);
                    }
                });
            });
            taskItem.querySelectorAll('.delete-subtask-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const subtaskId = parseInt(e.target.closest('.subtask-item').dataset.subtaskId);
                    deleteSubtask(task.id, subtaskId);
                });
            });
            taskItem.querySelectorAll('.edit-subtask-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const subtaskItem = e.target.closest('.subtask-item');
                    subtaskItem.classList.add('editing');
                    
                    const subtaskId = parseInt(subtaskItem.dataset.subtaskId);
                    const subtaskTextElem = subtaskItem.querySelector('.subtask-text');
                    const currentText = subtaskTextElem.textContent;
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = currentText;
                    input.className = 'subtask-text-edit';
                    
                    input.addEventListener('blur', () => {
                        subtaskItem.classList.remove('editing');
                        const newText = input.value.trim();
                        if (newText) {
                            const subtask = task.subtasks.find(st => st.id === subtaskId);
                            if (subtask) {
                                subtask.text = newText;
                                saveTasks();
                                renderTasks();
                            }
                        }
                    });
                    
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            input.blur();
                        }
                    });
                    
                    subtaskTextElem.replaceWith(input);
                    input.focus();
                });
            });
    
            taskTextSpan.addEventListener('dblclick', (e) => {
                e.stopPropagation(); 
                const input = document.createElement('input');
                input.type = 'text';
                input.value = task.text;
                input.className = 'task-text-edit';
                
                input.addEventListener('blur', () => {
                    const newText = input.value.trim();
                    if (newText) {
                        task.text = newText;
                        saveTasks();
                        renderTasks();
                    }
                });
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        input.blur();
                    }
                });
                
                taskTextSpan.replaceWith(input);
                input.focus();
            });
    
            const subtasksSection = taskItem.querySelector('.subtasks-section');
            const taskContent = taskItem.querySelector('.task-content');
    
            const hasSubtasks = task.subtasks && task.subtasks.length > 0;

            if (hasSubtasks) {
                const isCollapsed = task.completed || task.collapsed;
                if (isCollapsed) {
                    subtasksSection.style.display = 'none';
                    taskItem.classList.add('collapsed');
                } else {
                    subtasksSection.style.display = 'block';
                }
                
                const taskDetails = taskItem.querySelector('.task-details');
                const collapseIcon = document.createElement('i');
                collapseIcon.className = `fas ${isCollapsed ? 'fa-chevron-down' : 'fa-chevron-up'}`;
                collapseIcon.style.padding = '0 0.5rem';
                collapseIcon.style.cursor = 'pointer';
                taskDetails.prepend(collapseIcon);
                
                taskItem.addEventListener('click', (e) => {
                    if (
                        e.target.tagName === 'INPUT' || 
                        e.target.tagName === 'BUTTON' || 
                        e.target.closest('.task-actions') ||
                        e.target.classList.contains('task-text') ||
                        e.target.classList.contains('priority') ||
                        e.target.classList.contains('due-date') ||
                        subtaskInputContainer.style.display === 'flex'
                    ) {
                        return;
                    }
                    
                    const isCollapsed = subtasksSection.style.display === 'none';
                    subtasksSection.style.display = isCollapsed ? 'block' : 'none';
                    taskItem.classList.toggle('collapsed', !isCollapsed);
                    collapseIcon.className = `fas ${isCollapsed ? 'fa-chevron-up' : 'fa-chevron-down'}`;
                    
                    task.collapsed = !isCollapsed;
                    saveTasks();
                    
                    addSubtaskBtn.style.display = isCollapsed ? 'block' : 'none';
                });
            } else {
                subtasksSection.style.display = 'block';
            }
            
            addSubtaskBtn.style.display = 'block';
    
            taskItem.querySelectorAll('.subtask-input-actions button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            });
    
            subtaskInput.addEventListener('click', (e) => {
                e.stopPropagation();
            });
    
            return taskItem;
        }
   
        function createEditInput(value, onSave) {
            const input = document.createElement('input');
            input.type = 'text';
            input.value = value;
            input.className = 'task-text'; 
    
            input.addEventListener('blur', () => onSave(input.value.trim()));
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    onSave(input.value.trim());
                }
            });
            return input;
        }
    
        function createPrioritySelect(currentPriority, onSave) {
            const select = document.createElement('select');
            select.className = 'priority-select';
            select.innerHTML = `
                <option value="low" ${currentPriority === 'low' ? 'selected' : ''}>Low</option>
                <option value="medium" ${currentPriority === 'medium' ? 'selected' : ''}>Medium</option>
                <option value="high" ${currentPriority === 'high' ? 'selected' : ''}>High</option>
            `;
            select.addEventListener('change', () => onSave(select.value));
            return select;
        }
    
        function createDateInput(currentDate, onSave) {
            const input = document.createElement('input');
            input.type = 'date';

            input.value = currentDate ? formatDate(currentDate) : '';
            input.className = "due-date-input";
            input.addEventListener('change', () => onSave(input.value));
            return input;
        }
    
        function formatDate(dateString) {
            if (!dateString) return ''; 
            const date = new Date(dateString);

            const offset = date.getTimezoneOffset() * 60000;
            const localDate = new Date(date.getTime() + offset);
            return localDate.toISOString().split('T')[0];
        }
    
        function toggleComplete(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                if (task.completed) {
                    task.collapsed = true;  
                } else {
                    task.collapsed = false;
                }
                saveTasks();
                renderTasks();
                updateStats();
            }
        }
    
        function deleteTask(taskId) {
            tasks = tasks.filter(t => t.id !== taskId);
            saveTasks();
            renderTasks();
            updateStats();
        }
    
        function applyFilter(e) {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            currentFilter = e.target.dataset.filter;
            renderTasks();
        }
    
        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            totalTasksSpan.textContent = total;
            completedTasksSpan.textContent = completed;
        }
    
        function clearInputs() {
            taskInput.value = '';
            prioritySelect.value = 'low';
            dueDateInput.value = '';
        }
    
        function saveTasks() {
            localStorage.setItem(storageKey, JSON.stringify(tasks));
        }
    
        function loadTasks() {
            const tasks = JSON.parse(localStorage.getItem(storageKey)) || [];
            // Ensure all tasks have the collapsed property
            tasks.forEach(task => {
                if (task.collapsed === undefined) {
                    task.collapsed = task.completed;
                }
            });
            return tasks;
        }
    
        function toggleSubtaskComplete(taskId, subtaskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.subtasks) {
                const subtask = task.subtasks.find(st => st.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    updateParentTaskCompletion(taskId);
                    saveTasks();
                    renderTasks();
                }
            }
        }
    
        function deleteSubtask(taskId, subtaskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.subtasks) {
                task.subtasks = task.subtasks.filter(st => st.id !== subtaskId);
                updateParentTaskCompletion(taskId);
                saveTasks();
                renderTasks();
            }
        }
    
        function updateParentTaskCompletion(taskId, skipRender = false) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
    
            const hadSubtasks = task.subtasks && task.subtasks.length > 0;
            const newCompletedState = hadSubtasks 
                ? task.subtasks.every(st => st.completed)
                : false;
    
            if (task.completed !== newCompletedState) {
                task.completed = newCompletedState;
                
                if (skipRender) {
                    const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
                    if (taskElement) {
                        taskElement.classList.toggle('completed', task.completed);
                        const checkbox = taskElement.querySelector('.task-checkbox');
                        if (checkbox) checkbox.checked = task.completed;
                    }
                }
            }
    
            saveTasks();
            if (!skipRender) {
                renderTasks();
            }
        }

        function formatDateTimeShort(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: 'numeric',
                hour12: true
            });
        }

        function formatDateTime(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: 'numeric',
                hour12: true
            });
        }

        function addTestTasks() {
            const baseId = Date.now(); // Get a base timestamp to work from
            let idCounter = 0;

            const funnyTasks = [
                {
                    text: "Defeat the Laundry Volcano erupting in my closet",
                    priority: "high",
                    dueDate: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                    subtasks: [
                        { id: baseId + idCounter++, text: "Find matching socks (mission impossible)", completed: false },
                        { id: baseId + idCounter++, text: "Negotiate with shirt wrinkle rebels", completed: false }
                    ]
                },
                {
                    text: "Train goldfish to do synchronized swimming",
                    priority: "medium",
                    dueDate: new Date(Date.now() + 259200000).toISOString().split('T')[0],
                    subtasks: [
                        { id: baseId + idCounter++, text: "Buy tiny underwater LED lights", completed: false },
                        { id: baseId + idCounter++, text: "Create fish-sized podium for medal ceremony", completed: false }
                    ]
                },
                {
                    text: "Invent self-cleaning coffee mug that also does stand-up comedy",
                    priority: "low",
                    dueDate: new Date(Date.now() + 604800000).toISOString().split('T')[0],
                    subtasks: [
                        { id: baseId + idCounter++, text: "Research why coffee mugs always develop personality", completed: false },
                        { id: baseId + idCounter++, text: "Test joke: 'Why did the coffee file a police report? It got mugged!'", completed: true }
                    ]
                },
                {
                    text: "Convince cat that 3AM is not taco time",
                    priority: "high",
                    dueDate: new Date(Date.now() + 172800000).toISOString().split('T')[0],
                    subtasks: [
                        { id: baseId + idCounter++, text: "Create PowerPoint presentation on feline nutrition schedules", completed: false },
                        { id: baseId + idCounter++, text: "Practice 'disappointed parent' look for negotiations", completed: false }
                    ]
                }
            ];

            funnyTasks.forEach((task, index) => {
                tasks.unshift({
                    id: baseId + idCounter++, // Unique task ID
                    completed: false,
                    createdAt: new Date().toISOString(),
                    collapsed: false,
                    ...task
                });
            });

            saveTasks();
            renderTasks();
            updateStats();
        }

        document.getElementById('add-test-data').addEventListener('click', addTestTasks);
    });
    </script>
</body>
</html>